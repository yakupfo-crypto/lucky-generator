<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lucky Generator</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f2f6fb;
  padding-bottom: 100px;
}

header{
  background:#1976d2;
  color:white;
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

.container{ padding:20px; }

.card{
  background:white;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

input{
  width:100%;
  padding:8px;
  margin:5px 0 10px 0;
}

button{
  background:#1976d2;
  color:white;
  border:none;
  padding:10px;
  width:100%;
  border-radius:6px;
  font-size:16px;
}

.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#1976d2;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

.bottom-nav button{
  background:none;
  color:white;
  border:none;
}
.ball-row{
display:flex;
flex-wrap:wrap;
gap:8px;
margin-top:10px;
}

.ball{
width:38px;
height:38px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:600;
font-size:14px;
background:#eef3ff;
color:#1a2a6c;
}

.ball.selected{
background:#2d6cdf;
color:#fff;
}

.ball.joker{
background:#ff9800;
color:#fff;
}
.ball.result-selected{
background:#4caf50;
color:#fff;
}
</style>
</head>

<body>

<header>Lucky Generator</header>

<div class="container" id="generatePage">

<div class="card">
<label>Toplam Sayı</label>
<input type="number" id="maxNumber" value="34">

<label>Kolon Başına</label>
<input type="number" id="perSet" value="5">

<label>Joker</label>
<input type="number" id="jokerCount" value="1">

<label>Kolon Sayısı</label>
<input type="number" id="setCount" value="5">

<button onclick="generateSets()">Kolonları Üret</button>
</div>

<div id="results"></div>

</div>

<div class="container" id="mySetsPage" style="display:none;">
<h3>My Sets</h3>
<div id="savedSets"></div>
</div>

<div class="bottom-nav">
<button onclick="showGenerate()">Generate</button>
<button onclick="showMySets()">My Sets</button>
</div>

<script>

const resultNumbers = document.getElementById("resultNumbers");
const generatePage = document.getElementById("generatePage");
const mySetsPage = document.getElementById("mySetsPage");
const results = document.getElementById("results");
const savedSets = document.getElementById("savedSets");
let generatedSets=[];
let selectedResult=[];
let savedGroups=JSON.parse(localStorage.getItem("savedGroups"))||[];
let activeResultGroupId = null;
let groupCounter=savedGroups.length>0
?Math.max(...savedGroups.map(g=>g.id))+1
:1;
let selectedResultMap = {}; // { groupId: [1,2,3] }

function toggleResultNumber(el, groupId){
  let val = parseInt(el.innerText);
  if(!selectedResultMap[groupId]) selectedResultMap[groupId] = [];
  
  if(selectedResultMap[groupId].includes(val)){
    selectedResultMap[groupId] = selectedResultMap[groupId].filter(n=>n!==val);
    el.classList.remove("result-selected");
  } else {
    selectedResultMap[groupId].push(val);
    el.classList.add("result-selected");
  }
}
function createBalls(set){
let balls="<div class='ball-row'>";

set.numbers.forEach(n=>{
balls+=`<div class="ball selected">${n}</div>`;
});

set.jokers.forEach(j=>{
balls+=`<div class="ball joker">${j}</div>`;
});

balls+="</div>";
return balls;
}

function generateSets(){

const max=parseInt(maxNumber.value);
const per=parseInt(perSet.value);
const joker=parseInt(jokerCount.value);
const count=parseInt(setCount.value);

generatedSets=[];

for(let i=0;i<count;i++){

let numbers=[];
while(numbers.length<per){
let n=Math.floor(Math.random()*max)+1;
if(!numbers.includes(n)) numbers.push(n);
}
numbers.sort((a,b)=>a-b);

let jokers=[];
while(jokers.length<joker){
let j=Math.floor(Math.random()*max)+1;
if(!jokers.includes(j)) jokers.push(j);
}

generatedSets.push({numbers,jokers,max});
}

displayGenerated();
}

function displayGenerated(){

let html="";

generatedSets.forEach((set,i)=>{

html+=`
<div class='card'>
<b>${i+1})</b>
${createBalls(set)}
</div>
`;

});

if(generatedSets.length>0){
html+=`<button onclick='saveGroup()'>Kaydet</button>`;
}

results.innerHTML=html;

}

function saveGroup(){

let name=prompt("Grup adı:");
if(!name) return;

savedGroups.push({
id:groupCounter++,
name:name,
sets:[...generatedSets],
max:generatedSets[0].max
});

localStorage.setItem("savedGroups",JSON.stringify(savedGroups));
alert("Kaydedildi");

}

function showGenerate(){
generatePage.style.display="block";
mySetsPage.style.display="none";
}

function showMySets(){

generatePage.style.display="none";
mySetsPage.style.display="block";

let html="";

savedGroups.forEach(group=>{

html+=`
<div class='card'>
<b>[${group.id}] ${group.name}</b><br>
Kolon: ${group.sets.length}<br>
<button onclick='viewGroup(${group.id})'>Görüntüle</button>
<button onclick='deleteGroup(${group.id})'>Sil</button>
</div>
`;

});

savedSets.innerHTML=html;

}

function viewGroup(id){

let group=savedGroups.find(g=>g.id===id);
if(!group) return;

let html=`<h3>${group.name}</h3>`;
html+=`
<div class="card">
<b>Result:</b> <span id="resultText-${group.id}">${(selectedResultMap[group.id]||[]).join(", ")||"-"}</span>
<br>
<button onclick="openResultPanel(${group.max}, ${group.id})">Sonuç Gir</button>
</div>
`;
group.sets.forEach((set,i)=>{

html+=`
<div class='card'>
<b>${i+1})</b>
${createBalls(set)}
</div>
`;

});

html+=`<button onclick='showMySets()'>Geri</button>`;

savedSets.innerHTML=html;

}

function deleteGroup(id){

savedGroups=savedGroups.filter(g=>g.id!==id);
localStorage.setItem("savedGroups",JSON.stringify(savedGroups));
showMySets();

}
function openResultPanel(max, groupId) {
  if (!max || isNaN(max)) {
    let group = savedGroups.find(g => g.id === groupId);
    max = group ? group.max : 34;
  }

  activeResultGroupId = groupId;
  const resultPanel = document.getElementById("resultPanel");
  const resultNumbers = document.getElementById("resultNumbers");
  let html = "";
  let selected = selectedResultMap[groupId] || [];

  for (let i = 1; i <= max; i++) {
    html += `<div class="ball ${selected.includes(i) ? "result-selected" : ""}" onclick="toggleResultNumber(this, ${groupId})">${i}</div>`;
  }
  resultNumbers.innerHTML = html;
  resultPanel.style.display = "block";
}

function closeResultPanel(){
document.getElementById("resultPanel").style.display="none";
}

function confirmResult(groupId=activeResultGroupId){
  document.getElementById("resultPanel").style.display="none";
  let el=document.getElementById(`resultText-${groupId}`);
  if(el) el.innerText=(selectedResultMap[groupId]||[]).join(", ")||"-";
  updateMatches(groupId);
}

function cleanResult(groupId=activeResultGroupId){
  selectedResultMap[groupId]=[];
  document.querySelectorAll("#resultNumbers .ball").forEach(b=>b.classList.remove("result-selected"));
  let el=document.getElementById(`resultText-${groupId}`);
  if(el) el.innerText="-";
  updateMatches(groupId);
}

function updateMatches(groupId=activeResultGroupId){
  let result = selectedResultMap[groupId] || [];
  document.querySelectorAll(".card").forEach(card=>{
    card.querySelectorAll(".ball").forEach(b=>{
      if(b.classList.contains("joker")) return;
      let val=parseInt(b.innerText);
      if(result.includes(val)){
        b.classList.add("result-selected");
      } else {
        b.classList.remove("result-selected");
      }
    });
  });
}
</script>
<div id="resultPanel" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:#fff; padding:15px; box-shadow:0 -2px 10px rgba(0,0,0,0.2); max-height:70%; overflow:auto;">

<h3>Sonuç Gir <span onclick="closeResultPanel()" style="float:right;cursor:pointer;">✖</span></h3>

<div id="resultNumbers" class="ball-row"></div>

<button onclick="confirmResult(activeResultGroupId)">Onayla</button>
<button onclick="cleanResult(activeResultGroupId)" style="background:#999;margin-top:8px;">Temizle</button>

</div>
</body>
</html>